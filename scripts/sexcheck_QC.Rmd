---
title: "Sex inconsistencies"
author: "Shea Andrews"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
params:
  Path_SexFile: 
  rwd:
editor_options: 
  chunk_output_type: console
---

## Sex Discordance 

Samples with discrpencies between self-reported sex and predicted sex based on genetic data are likely indicative of errors in sample handling. Predicted sex can be determined by calculating the X chromosome heterozygosity rates (F, --check-sex option in PLINK), with a value of ~0.99 in reported females indicating the sample is genetilcy male; a valule of ~0.03 in reported males indicating that sample is geneticly female. Furthermore, checking X chromosome heterozygosity may revel sex chromosome anomalies (~0.28 in reported females; ~0.35 in males).  
<br> 

Identification of individules with discordent sex information can be done in PLINK by typing the following at the shell prompt, which will produce a list of individules with discordent sex data.
```{bash, eval=F}
plink_1.9 --bfile raw-GWA-data  \
  --check-sex --out --out output.sexcheck
```
<br> 

```{r setup sexcheck, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = params$rwd)

## ---- Load Pacakges ---- ##
library(tidyverse)
library(ggplot2)
library(knitr)
```

```{r read in sex check data, echo=F, message=F, warning=F}
## ---- Read in Data ----##

sexcheck.raw <- read_table(params$Path_SexFile)

##  recode sex varibles
sexcheck <- sexcheck.raw %>%
  mutate(PEDSEX = recode(PEDSEX, '2' = 'Female', '1' = 'Male'))

##  Exclude samples with no sex inconsistencies
exclude.samples <- sexcheck %>% 
  filter(STATUS == 'PROBLEM') %>% 
  mutate(PEDSEX = recode(PEDSEX, '2' = 'Female', '1' = 'Male'))
```

The following plot (Fig. 1) displays the X Chromosome heterozygosity for self reported sex, with samples with problems highlighted in red. Table 1 displays the individule records that should be excluded from further downstream analysis.
```{r plot, echo=FALSE, fig.width=5.5, fig.height=4.7, fig.align='center', fig.cap='X chromosome heterozygosity in self repoted males & femalse'}
ggplot(data = sexcheck, aes(x = as.factor(PEDSEX), y = F, colour = STATUS, shape = STATUS)) + 
  geom_jitter() + 
  scale_color_manual(values = c( "#377EB8", "#E41A1C")) + 
  theme_bw() + labs(x = 'Self reported sex', y = 'X CHR Heterozygocity (F)') + theme(legend.position="bottom")
```
<br>

***Table 1:*** Samples with sex discordance
```{r table, echo=FALSE}
##  Print samples with sex inconsistencies
as.data.frame(exclude.samples) 

```


```{r write_out, echo=FALSE}

##  write out samples to be excluded
#exclude.samples <- exclude.samples %>%  select(FID, IID)
#write_tsv(exclude.samples, outfile, col_names = T)

```
<br>
